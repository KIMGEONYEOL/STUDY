[JPA êµ¬í˜„ ë°©ë²•]

ì²«ë²ˆì§¸, --------------------------------------------------------------------------
1. í•´ë‹¹ í…Œì´ë¸”ì— ëŒ€í•œ Entity í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
2. JpaRepository ë¥¼ ìƒì†ë°›ì€ Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
3. Service í´ë˜ìŠ¤ì—ì„œ í•´ë‹¹ Repository ë¥¼ í•„ë“œë¡œ ì˜ì¡´ì„±ì£¼ì… ì„ ì–¸í•œ ë‹¤ìŒ, 
   ê° ë©”ì†Œë“œ ì•ˆì—ì„œ JPA ê°€ ì œê³µí•˜ëŠ” ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ëŠ¥ì„ ë™ì‘ì‹œí‚¨ë‹¤.
4. í•„ìš”ì‹œ Repository ì¸í„°í˜ì´ìŠ¤ì— í•„ìš”í•œ ë©”ì†Œë“œë¥¼ ì¶”ê°€ ì„ ì–¸í•´ì„œ ì‚¬ìš©í•´ë„ ë¨
	=> í•„ìš”í•œ sql êµ¬ë¬¸ì„ ì‘ì„±í•˜ì—¬ êµ¬ë™í•˜ëŠ” êµ¬ë¬¸ì„ ì‘ì„±í•œë‹¤.
	** JPQL êµ¬ë¬¸ì„ ì‚¬ìš©í•¨

ë‘ë²ˆì§¸, ---------------------------------------------------------------------------
1. í•´ë‹¹ í…Œì´ë¸”ì— ëŒ€í•œ Entity í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
2. JpaRepository ë¥¼ ìƒì†ë°›ì€ Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
3. Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ì€ RepositoryImpl í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
	=> ì˜¤ë²„ë¼ì´ë”©í•œ ë©”ì†Œë“œ ì•ˆì—ì„œ EntityManager ë¥¼ ì‚¬ìš©í•˜ì—¬
	í•„ìš”í•œ sql êµ¬ë¬¸ì„ ì‘ì„±í•˜ì—¬ êµ¬ë™í•˜ëŠ” êµ¬ë¬¸ì„ ì‘ì„±í•œë‹¤.
	** JPQL êµ¬ë¬¸ì„ ì‚¬ìš©í•¨
4. Service í´ë˜ìŠ¤ì—ì„œ í•´ë‹¹ Repository ë¥¼ í•„ë“œë¡œ ì„ ì–¸í•œ ë‹¤ìŒ, 
   ê° ë©”ì†Œë“œ ì•ˆì—ì„œ RepositoryImpl í´ë˜ìŠ¤ì—ì„œ ì‘ì„±í•œ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ 
   ê¸°ëŠ¥ì„ ë™ì‘ì‹œí‚¨ë‹¤.

ì„¸ë²ˆì§¸, ---------------------------------------------------------------------------
1. í•´ë‹¹ í…Œì´ë¸”ì— ëŒ€í•œ Entity í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
2. JpaRepository ë¥¼ ìƒì†ë°›ì€ Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
3. ë³„ë„ì˜ dao í´ë˜ìŠ¤ë¥¼ ë§Œë“¦ => EntityManager ë¥¼ ì‚¬ìš©í•˜ì—¬ ë©”ì†Œë“œ ê¸°ëŠ¥ êµ¬í˜„í•¨
  ** JPQL êµ¬ë¬¸ ë˜ëŠ” QueryDSL ì‚¬ìš©í•¨
4. Service í´ë˜ìŠ¤ì—ì„œ í•´ë‹¹ DAOë¥¼ í•„ë“œë¡œ ì„ ì–¸í•œ ë‹¤ìŒ, 
   ê° ë©”ì†Œë“œ ì•ˆì—ì„œ DAO í´ë˜ìŠ¤ì—ì„œ ì‘ì„±í•œ ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ 
   ê¸°ëŠ¥ì„ ë™ì‘ì‹œí‚¨ë‹¤.


[ì‘ì—… ìˆœì„œ] *************************************************
1. jpa ì— ëŒ€í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ dependency ì¶”ê°€í•¨
//---------------------------------------------------------------------------------
... ì¤‘ê°„ ìƒëµ ...
implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
//jpa
implementation 'org.hibernate:hibernate-entitymanager:5.3.10.Final'
implementation 'org.hibernate.javax.persistence:hibernate-jpa-2.1-api:1.0.2.Final'
implementation 'javax.xml.bind:jaxb-api:2.3.1'

// ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ì´ìƒ : Unable to load class 'javax.persistence.Entity'. ì—ëŸ¬ ë°œìƒí•  ê²½ìš°
//implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
//annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jakarta"

// ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ë¯¸ë§Œ
implementation 'com.querydsl:querydsl-jpa'
annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jpa"

implementation 'com.querydsl:querydsl-core'
implementation "com.querydsl:querydsl-collections"

annotationProcessor "jakarta.annotation:jakarta.annotation-api" // java.lang.NoClassDefFoundError (javax.annotation.Generated) ì—ëŸ¬ ëŒ€ì‘ ì½”ë“œ
annotationProcessor "jakarta.persistence:jakarta.persistence-api" // java.lang.NoClassDefFoundError (javax.annotation.Entity) ì—ëŸ¬ ëŒ€ì‘ ì½”ë“œ
... ì¤‘ê°„ ìƒëµ ...
//--------------------------------------------------------------------------------


2. application.properties ì— jpa ì‚¬ìš©ì— ëŒ€í•œ ì„¤ì • ì¶”ê°€í•¨ 
//---------------------------------------------------------------------------------
.... ì¤‘ê°„ ìƒëµ .....

#dbms
spring.datasource.url=jdbc:oracle:thin:@localhost:1521:XE
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver
spring.datasource.username=c##testweb
spring.datasource.password=testweb

#jpa
spring.jpa.show-sql=true     
# ì‹¤í–‰ ì¿¼ë¦¬ë¬¸ ë³´ì´ê²Œ í•¨
#spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.hibernate.ddl-auto=none   
 # ìë™ ddl êµ¬ë¬¸ ì‘ë™ ì•ˆ ë˜ê²Œ í•¨
spring.jpa.generate-ddl=true

spring.jpa.properties.hibernate.format_sql=true
spring.jpa.database=oracle
spring.jpa.database-platform=org.hibernate.dialect.Oracle12cDialect
spring.jpa.properties.hibernate.id.new_generator_mappings=false
spring.jpa.defer-datasource-initialization=true

# ë¡œê·¸ ì¶œë ¥ ë ˆë²¨ ì§€ì •
logging.level.org.hibernate=info

# ì •ìƒì ì´ì§€ ì•Šì€ í´ë˜ìŠ¤ ê°ì²´ëŠ” ì§ë ¬í™” ë˜ì§€ ì•Šê²Œ ì§€ì •
spring.jackson.serialization.fail-on-empty-beans=false
spring.jackson.property-naming-strategy=SNAKE_CASE
# ì»¬ëŸ¼ëª… ì´ë¦„ í‘œê¸°ë²• ì§€ì • : ìŠ¤í”„ë§ì€ ê¸°ë³¸ SNAKE_CASE ì„, 
# ì†Œë¬¸ìë§Œ ì‚¬ìš©í•˜ê³  ë‹¨ì–´ ì‚¬ì´ì— '_' ë¥¼ ì‚¬ìš©í•˜ëŠ” í‘œê¸°ë²•ì„ ë§í•¨ (ì˜ˆ : user_name)
# ì‚¬ìš© ë°ì´í„°ë² ì´ìŠ¤ì— ë”°ë¼ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ì´ ì—†ëŠ” ê²½ìš°ì—ëŠ” ëŒ€ì†Œë¬¸ì ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥í•¨

... ìƒëµ ....
//-----------------------------------------------------------------------------------------


3. íŒ¨í‚¤ì§€ êµ¬ì¡°ëŠ” ì„ì˜ëŒ€ë¡œ ì§€ì •í•´ë„ ë¨
   ê¸°ì¡´ì˜ bootFirst_mybatis í”„ë¡œì íŠ¸ êµ¬ì¡°ë¥¼ ìµœëŒ€í•œ ê·¸ëŒ€ë¡œ ë‘ê³  jpa ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½í•œë‹¤ë©´,

   * ê¸°ì¡´ì˜ Board í…Œì´ë¸”ì„ ì›ê¸€(Board)ê³¼ ëŒ“ê¸€(Reply) í…Œì´ë¸”ë¡œ ë¶„ë¦¬í•˜ì˜€ìŒ *
   
   * jpa ê´€ë ¨ íŒ¨í‚¤ì§€ë¥¼ êµ¬ì„±í•¨ **********************************************

   ~.board.jpa.entity.BoardEntity.java : board í…Œì´ë¸”ì— ëŒ€í•œ ê°€ì´ë“œ í´ë˜ìŠ¤
   	=> BoardDto ì˜ property ì™€ board í…Œì´ë¸”ì˜ column ì„ ë§¤ì¹­í•¨
	=> @Column(name="ì»¬ëŸ¼ëª…", nullable="true | false", length=í¬ê¸°) ë“±ì„ ì§€ì •í•¨
	=> ì»¬ëŸ¼ì— ëŒ€í•œ @Id, primary key, not null ë“± ì œì•½ì¡°ê±´ ì„¤ì •í•¨
	=> @Entity ì„ ì–¸í•¨, @Table("í…Œì´ë¸”ëª…")
	=> ë¡¬ë³µì˜ @Data, @AllArgsConstructor, @NoArgsConstructor, @Builder ì„ ì–¸í•¨
	=> entity ë¥¼ dto ë¡œ ë³€í™˜í•˜ëŠ” ë©”ì†Œë“œ ì¶”ê°€í•¨ : public BoardDto toDto()
	=> ë‚ ì§œ ìë£Œí˜•ì„ LocalDateTime ìœ¼ë¡œ ë³€ê²½í•¨

   ~.board.jpa.entity.ReplyEntity.java : reply í…Œì´ë¸”ì— ëŒ€í•œ ê°€ì´ë“œ í´ë˜ìŠ¤
	=> ReplyDto ì˜ property ì™€ board í…Œì´ë¸”ì˜ column ì„ ë§¤ì¹­í•¨
	=> @Column(name="ì»¬ëŸ¼ëª…", nullable="true | false", length=í¬ê¸°) ë“±ì„ ì§€ì •í•¨
	=> ì»¬ëŸ¼ì— ëŒ€í•œ @Id, primary key, not null ë“± ì œì•½ì¡°ê±´ ì„¤ì •í•¨
	=> @Entity ì„ ì–¸í•¨, @Table("í…Œì´ë¸”ëª…")
	=> ë¡¬ë³µì˜ @Data, @AllArgsConstructor, @NoArgsConstructor, @Builder ì„ ì–¸í•¨
	=> entity ë¥¼ dto ë¡œ ë³€í™˜í•˜ëŠ” ë©”ì†Œë“œ ì¶”ê°€í•¨ : public ReplyDto toDto()
	=> ë‚ ì§œ ìë£Œí˜•ì„ LocalDateTime ìœ¼ë¡œ ë³€ê²½í•¨


   ~.board.jpa.repository.BoardRepository.java : 
	=> ì¸í„°í˜ì´ìŠ¤ë¡œ ì‘ì„±, JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ìŒ
	=> jpaê°€ ì œê³µí•˜ëŠ” ë©”ì†Œë“œê°€ ì•„ë‹Œ ê¸°ëŠ¥ì— ëŒ€í•´ ë©”ì†Œë“œ ì¶”ê°€í•  ìˆ˜ ìˆìŒ
	   * ì£¼ì˜ : Entity ë§Œ ì·¨ê¸‰í•¨ *
	=> ì¶”ê°€í•œ ë©”ì†Œë“œ ì‹œê·¸ë‹ˆì²˜ ìœ„ì— ì¿¼ë¦¬ë¬¸ ì‘ì„±í•¨
	  ex>
	   @Query("SELECT c FROM Counseling c WHERE LOWER(c.counTitle) LIKE LOWER(CONCAT('%', :counTitle, '%'))")
	   List<Counseling> findByTitle(@Param("counTitle") String counTitle);

   ~.board.jpa.repository.ReplyRepository.java : 
	=> ì¸í„°í˜ì´ìŠ¤ë¡œ ì‘ì„±, JpaRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†ë°›ìŒ
	=> jpaê°€ ì œê³µí•˜ëŠ” ë©”ì†Œë“œê°€ ì•„ë‹Œ ê¸°ëŠ¥ì— ëŒ€í•´ ë©”ì†Œë“œ ì¶”ê°€í•  ìˆ˜ ìˆìŒ
	   * ì£¼ì˜ : Entity ë§Œ ì·¨ê¸‰í•¨ *
	=> ì¶”ê°€í•œ ë©”ì†Œë“œ ì‹œê·¸ë‹ˆì²˜ ìœ„ì— ì¿¼ë¦¬ë¬¸ ì‘ì„±í•¨
	  ex>
	   //íŒ¨ìŠ¤ì›Œë“œ ìˆ˜ì •
	    @Modifying
	    @Query(value = "update Member set user_pw = :userPw where user_id = :userId", 
			nativeQuery = true)
	    void saveByPw(@Param("userPw") String userPw, @Param("userId") String userId);


   ~.board.model.service.BoardService.java : ì›ê¸€ ì²˜ë¦¬ìš©
   	=> @Service, @Transactional ì„ ì–¸í•¨
	=> BoardRepository ì˜ì¡´ì„± ì£¼ì…í•¨
	=> repository ì œê³µ ë©”ì†Œë“œ ì‚¬ìš© êµ¬ë¬¸ìœ¼ë¡œ ë³€ê²½í•¨
	   dto ë¥¼ entity ë¡œ ë³€í™˜í•´ì„œ repository ë©”ì†Œë“œì— ì ìš©í•¨
	   í•„ìš”ì‹œ ë¦¬í„´íƒ€ì…ë„ ë³€ê²½í•¨

   ~.board.model.service.ReplyService.java : ëŒ“ê¸€/ëŒ€ëŒ“ê¸€ ì²˜ë¦¬ìš©
   	=> @Service, @Transactional ì„ ì–¸í•¨
	=> ReplyRepository ì˜ì¡´ì„± ì£¼ì…í•¨
	=> repository ì œê³µ ë©”ì†Œë“œ ì‚¬ìš© êµ¬ë¬¸ìœ¼ë¡œ ë³€ê²½í•¨
	   dto ë¥¼ entity ë¡œ ë³€í™˜í•´ì„œ repository ë©”ì†Œë“œì— ì ìš©í•¨
	   í•„ìš”ì‹œ ë¦¬í„´íƒ€ì…ë„ ë³€ê²½í•¨


   ** dto(Data Transfer Object, vo | domain ê³¼ ê°™ì€ ì˜ë¯¸ì˜ ìš©ì–´ì„) **
   	=> ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•¨

   ~.board.model.dto.BoardDto.java : ì›ê¸€ property ì €ì¥ìš©
   ~.board.model.dto.ReplyDto.java : ëŒ“ê¸€/ëŒ€ëŒ“ê¸€ property ì €ì¥ìš©
   	=> @Data 
	   @NoArgsConstructor
	   @AllArgsConstructor
	   @Validated
	   @Builder
	   @Component
	=> entity ë¥¼ dto ë¡œ ë³€í™˜í•˜ëŠ” ë©”ì†Œë“œ ì¶”ê°€í•¨
	=> ë‚ ì§œ ìë£Œí˜•ì„ LocalDateTime ìœ¼ë¡œ ë³€ê²½í•¨


   ~.board.controller.BoardController.java ìˆœìœ¼ë¡œ ì‘ì—…í•¨


[JPA í˜ì´ì§• ì²˜ë¦¬] -----------------------------------------------------------

import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
ì‚¬ìš©í•¨

* [ì„¤ëª…] * ***********************
Pageable ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ë¥¼ JpaRepository ë©”ì†Œë“œì— íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì£¼ë©´ ìë™ìœ¼ë¡œ í˜ì´ì§• ì²˜ë¦¬ê°€ ë¨. 
ê°œë°œìê°€ Pageable ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§ì ‘ ì¡°ì‘í•˜ëŠ” ì¼ì€ ë³„ë¡œ ì—†ìŒ. 

* Pageable ì¸í„°í˜ì´ìŠ¤ê°€ ì œê³µí•˜ëŠ” ë©”ì†Œë“œ ìš”ì•½ *******************
JPA ê°€ í˜ì´ì§• ì²˜ë¦¬ë¥¼ ìœ„í•´ í•„ìš”í•œ ê¸°ëŠ¥ë“¤ì„ ëª…ì„¸í•˜ê³  ìˆìŒ.

 + getPageNumber ë©”ì†Œë“œ - í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ë°˜í™˜
 + getPageSize ë©”ì†Œë“œ - í•œ í˜ì´ì§€ì—ì„œ ë³´ì—¬ì¤„ í•­ëª©ë“¤ì˜ ê°œìˆ˜ë¥¼ ë°˜í™˜
 + getOffset ë©”ì†Œë“œ - í˜ì´ì§€ í¬ê¸°ì— ë”°ë¼ ì·¨í•  ì˜¤í”„ì…‹ì„ ë°˜í™˜
 + next ë©”ì†Œë“œ - ë‹¤ìŒ í˜ì´ì§€ë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•˜ëŠ” Pageable ì¸í„°í˜ì´ìŠ¤ë¥¼ ë°˜í™˜
 + first ë©”ì†Œë“œ - ì²«ë²ˆì§¸ í˜ì´ì§€ë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•˜ëŠ” Pageable ì¸í„°í˜ì´ìŠ¤ë¥¼ ë°˜í™˜
 + previousOrFirst ë©”ì†Œë“œ - ì´ì „ í˜ì´ì§€ë¥¼ ì¡°íšŒí•  ë•Œ ì‚¬ìš©í•˜ëŠ” Pageable ì¸í„°í˜ì´ìŠ¤ë¥¼ ë°˜í™˜
		ê°€ì¥ ì²« í˜ì´ì§€ì¸ ê²½ìš°ì—ëŠ” ì²« í˜ì´ì§€ë¥¼ ìœ„í•œ Pageable ì¸í„°í˜ì´ìŠ¤ë¥¼ ë°˜í™˜


1. Pageable ì¸í„°í˜ì´ìŠ¤ êµ¬ì¡° *************************
public interface Pageable {

    // ... 

    int getPageNumber();
    int getPageSize();
    long getOffset();
    Pageable next();
    Pageable previousOrFirst();
    Pageable first();
}


2. PageRequest í´ë˜ìŠ¤ ******************************
í˜ì´ì§• ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë„ë¡ Pageable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ê°ì²´ë¥¼ JpaRepositoryì—ê²Œ ì „ë‹¬í•´ì•¼ í•¨. 
Spring í”„ë ˆì„ì›Œí¬ì—ì„œëŠ” Pageable ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ë¥¼ ì‰½ê²Œ ìƒì„±í•  ìˆ˜ ìˆë„ë¡ 
PageRequest í´ë˜ìŠ¤ë¥¼ ì œê³µí•¨.

 (1) PageRequest í´ë˜ìŠ¤ of ë©”ì†Œë“œ

  of ë©”ì†Œë“œì— ë“¤ì–´ê°„ íŒŒë¼ë¯¸í„°ë¥¼ ì˜ˆë¡œ ë“¤ë©´,
  Sort.by(Direction.DESC, â€œtestValueâ€) -> testValue í•„ë“œ ê°’ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬í•œ í•­ëª©(row)ë“¤ì„
  100 - 100ê°œì”© í•˜ë‚˜ì˜ í˜ì´ì§€ë¡œ ì¶œë ¥í•˜ê³ 
  0 - 0ë²ˆì§¸ í˜ì´ì§€ì— ëŒ€í•´
  ì˜ˆ>
  Pageable pageable = PageRequest.of(0, 100, Sort.by(Direction.DESC, "testValue"));


3. Page í´ë˜ìŠ¤ ******************************************
í˜ì´ì§• ì²˜ë¦¬ê°€ ë˜ì–´ ë°˜í™˜ë˜ëŠ” ê²°ê³¼ëŠ” Page<T> í´ë˜ìŠ¤ì— ë‹´ê²¨ ë°˜í™˜ë¨. 
Page<T> í´ë˜ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì •ë³´ë¥¼ ì§€ë‹˜.

 + getPageable ë©”ì†Œë“œ - í˜ì´ì§• ì²˜ë¦¬ì—ì„œ ì‚¬ìš©í•œ Pageable ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ ì •ë³´
 + getContent ë©”ì†Œë“œ - í•´ë‹¹ í˜ì´ì§€ì— í•´ë‹¹ë˜ëŠ” í•­ëª©(row) ë¦¬ìŠ¤íŠ¸
 + getTotalElements ë©”ì†Œë“œ - ì¡°íšŒ ì¡°ê±´ì— ì¼ì¹˜í•˜ëŠ” ì´ í•­ëª© ìˆ˜
 + getTotalPages ë©”ì†Œë“œ - ì´ í˜ì´ì§€ ê°œìˆ˜

 => PageRequest í´ë˜ìŠ¤ of ë©”ì†Œë“œë¥¼ í†µí•´ ì–»ì€ Pageable êµ¬í˜„ì²´ëŠ” ì•„ë˜ ì½”ë“œì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ. 
    JapRepositoryì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” findAll ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ì˜€ì„ ë•Œ,

    Pageable pageable = PageRequest.of(0, 10, Sort.by(Direction.DESC, "testValue"));
    Page<TestEntity> testEntities = testRepository.findAll(pageable);


4. í˜ì´ì§• ì²˜ë¦¬ë¥¼ ìœ„í•œ JPA ì¿¼ë¦¬ë¬¸ ì‘ì„±ë°©ë²• *********************************

JPA í˜ì´ì§• ì²˜ë¦¬ ë°©ë²•ì„ ì„¸ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ êµ¬í˜„í•œë‹¤ë©´,

 (1) JpaRepository ë©”ì†Œë“œ ì´ë¦„ ê·œì¹™ì„ í™œìš©í•œ findBy ë©”ì†Œë“œ ì¶”ê°€í•´ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
 (2) @Query ì• ë„ˆí…Œì´ì…˜ with JPQL êµ¬ë¬¸ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
 (3) @Query ì• ë„ˆí…Œì´ì…˜ with Native Query êµ¬ë¬¸ ì‚¬ìš©í•˜ëŠ” ë°©ë²•

4.1. TestEntity í´ë˜ìŠ¤ ì‘ì„± ì˜ˆ : 
// ----------------------------------------------------------------------
@Getter
@Setter
@NoArgsConstructor
@Entity
@Table(name = "TB_TABLE")
class TestEntity {
	
    public TestEntity(String value) {
        this.testValue = value;
    }

    @Id
    @GeneratedValue
    private long id;

    @Column(name = "TEST_VALUE")
    private String testValue;

    @Column(name = "CREATED_AT", updatable = false)
    private LocalDateTime createdAt;

    @PrePersist  //jpa ë¡œ ë„˜ì–´ê°€ì§€ ì „ì— ì‘ë™
    public void prePersist() {
        createdAt = LocalDateTime.now(); //createdAt ì— í˜„ì¬ ì‹œê°„ ì ìš©
    }

    @Override
    public String toString() {
        return "id: " + id + ", testValue: " + testValue + ", createdAt: " + createdAt;
    }
}
// -----------------------------------------------------------------------


4.2. ì²«ë²ˆì§¸ ë°©ë²• : findBy ë©”ì†Œë“œ ì¶”ê°€í•˜ì—¬ í˜ì´ì§• ì²˜ë¦¬ sql ë¬¸ ì‘ë™ 

 - testValue í•„ë“œ ê°’ì„ ë‚´ë¦¼ì°¨ìˆœ(desc)ìœ¼ë¡œ ì •ë ¬í•œë‹¤.
 - í˜ì´ì§€ ë‹¹ í•­ëª© ìˆ˜ë¥¼ 10ê°œì”© 0, 1ë²ˆ í˜ì´ì§€ë¥¼ ì¡°íšŒí•œë‹¤.
 - testValue í•„ë“œ ê°’ì´ â€˜Aâ€™ë¡œ ì‹œì‘ë˜ëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí•œë‹¤.
 - ë¬¸ìì—´ì˜ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠëŠ”ë‹¤. (case not sensitive)

// í˜¸ì¶œêµ¬ë¬¸ -----------------------------------------------------------------------
      
Pageable pageable = PageRequest.of(pageIndex, 10, Sort.by(Direction.DESC, "testValue"));
Page<TestEntity> testEntities = testRepository.findByTestValueStartsWith("A", pageable);

log.info("ì „ì²´ í˜ì´ì§€ ìˆ˜: " + testEntities.getTotalPages());
log.info("í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸: " + testEntities.getPageable().getPageNumber());
log.info("í˜ì´ì§€ ë³„ ì‚¬ì´ì¦ˆ: " + testEntities.getPageable().getPageSize());
log.info("ì¡°ê±´ ì¼ì¹˜ ì´ í•­ëª© ìˆ˜: " + testEntities.getTotalElements());
            
// repository ------------------------------------------------------------------
interface TestRepository extends JpaRepository<TestEntity, Long> {

    // ...

    Page<TestEntity> findByTestValueStartsWith(String testValue, Pageable pageable);
}
// ---------------------------------------------------------------------------


4.3. ë‘ë²ˆì§¸ ë°©ë²• : @Query + JPQL ì‚¬ìš© sql ì‘ë™ ì½”ë“œ 

 - testValue í•„ë“œ ê°’ì„ ë‚´ë¦¼ì°¨ìˆœ(desc)ìœ¼ë¡œ ì •ë ¬í•œë‹¤.
 - í˜ì´ì§€ ë‹¹ í•­ëª© ìˆ˜ë¥¼ 10ê°œì”© 0, 1ë²ˆ í˜ì´ì§€ë¥¼ ì¡°íšŒí•œë‹¤.
 - testValue í•„ë“œ ê°’ì´ â€˜Aâ€™ë¡œ ì‹œì‘ë˜ëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí•œë‹¤.
 - ë¬¸ìì—´ì˜ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠëŠ”ë‹¤. (case not sensitive)

// -------------------------------------------------------------------------

interface TestRepository extends JpaRepository<TestEntity, Long> {
    
    // ...

    //êµ¬ë¶„ : from ì ˆì— ì—”í‹°í‹° ì‚¬ìš©
    @Query(value = "SELECT t FROM TestEntity t WHERE t.testValue LIKE :testValue%", 
    countQuery = "SELECT COUNT(t) FROM TestEntity t WHERE t.testValue LIKE :testValue%")
    Page<TestEntity> findByValueStartsWithUsingJpql(@Param("testValue") String testValue, Pageable pageable);
}
// -------------------------------------------------------------------------------


4.4. @Query + Native Query ì‚¬ìš© sql ì‘ë™ ì½”ë“œ

 - TEST_VALUE ì»¬ëŸ¼ ê°’ì„ ë‚´ë¦¼ì°¨ìˆœ(desc)ìœ¼ë¡œ ì •ë ¬í•œë‹¤.
 - í˜ì´ì§€ ë‹¹ í•­ëª© ìˆ˜ë¥¼ 10ê°œì”© 0ë²ˆì§¸, 1ë²ˆ í˜ì´ì§€ë¥¼ ì¡°íšŒí•œë‹¤.
 - TEST_VALUE ì»¬ëŸ¼ ê°’ì´ â€˜Aâ€™ë¡œ ì‹œì‘ë˜ëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí•œë‹¤.
 - ë¬¸ìì—´ì˜ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (case not sensitive)
 ** ì£¼ì˜ : Native Queryë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— Sort.by ë©”ì†Œë“œì— â€œtestValueâ€ ê°’ì„ ì „ë‹¬í•˜ë©´ ì—ëŸ¬ê°€ ë°œìƒí•¨.
         ì¡°íšŒ ì‹œ ì‚¬ìš©ëœ ì¿¼ë¦¬ ë¡œê·¸ë¥¼ ë³´ë©´ order by t.TEST_VALUE desc limit ? ì¡°ê±´ì´ ì¶”ê°€ë˜ì—ˆìŒ.
         í˜ì´ì§• ì²˜ë¦¬ë¥¼ ìœ„í•œ count ì¿¼ë¦¬ê°€ ì¶”ê°€ ìˆ˜í–‰ë˜ì—ˆìŒ.
 
// í˜¸ì¶œ ì½”ë“œ -----------------------------------------------------------------

    Pageable pageable = PageRequest.of(pageIndex, 10, Sort.by(Direction.DESC, "TEST_VALUE"));
    Page<TestEntity> testEntities = testRepository.findByValueStartsWithUsingNative("A", pageable);

    log.info("ì „ì²´ í˜ì´ì§€ ìˆ˜: " + testEntities.getTotalPages());
    log.info("í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸: " + testEntities.getPageable().getPageNumber());
    log.info("í˜ì´ì§€ ë³„ ì‚¬ì´ì¦ˆ: " + testEntities.getPageable().getPageSize());
    log.info("ì¡°ê±´ ì¼ì¹˜ ì´ í•­ëª© ìˆ˜: " + testEntities.getTotalElements());
           

// ---------------------------------------------------------------------------
interface TestRepository extends JpaRepository<TestEntity, Long> {

    // ...

    //êµ¬ë¶„ : from ì ˆì— í…Œì´ë¸”ëª… ì‚¬ìš©	
    @Query(value = "SELECT * FROM TB_TABLE t WHERE TEST_VALUE LIKE :testValue%", 
    countQuery = "SELECT COUNT(*) FROM TB_TABLE t WHERE t.TEST_VALUE LIKE :testValue%", nativeQuery = true)
    Page<TestEntity> findByValueStartsWithUsingNative(@Param("testValue") String testValue, Pageable pageable);
}
// ---------------------------------------------------------------------------


// ****************************************************************
[QueryDSL ì‚¬ìš©]

QueryDSL ì€ í•œë§ˆë””ë¡œ SQL, JPQL ë“±ì„ ì½”ë“œë¡œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë¹Œë” ì˜¤í”ˆì†ŒìŠ¤ í”„ë ˆì„ì›Œí¬ì´ë‹¤.
QueryDSL ì€ JPA ë¿ë§Œ ì•„ë‹ˆë¼ SQL, Mongodb, Lucenece ë“± ë‹¤ì–‘í•œ ì–¸ì–´ì— ëŒ€í•´ì„œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•œë‹¤.
 => ê³µì‹ ì‚¬ì´íŠ¸ ì°¸ì¡° : http://querydsl.com/

QueryDSL JPA ëŠ”
 â‘  SQL, JPQL ì„ ì½”ë“œë¡œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë¹Œë” API ì´ê³ ,
 â‘¡ Entity í´ë˜ìŠ¤ì™€ ë§¤í•‘ë˜ëŠ” QClass ë¼ëŠ” ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œë‹¤.

QClass ë€ ?
 QueryDSL ì€ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ ì—”í‹°í‹°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ QClass ë¥¼ ìƒì„±í•˜ëŠ”ë° 
 JPAAnnotationProcessor ê°€ ì»´íŒŒì¼ ì‹œì ì— ì‘ë™í•´ì„œ @Entity ë“±ë“±ì˜ ì–´ë…¸í…Œì´ì…˜ì„ ì°¾ì•„ 
 í•´ë‹¹ íŒŒì¼ë“¤ì„ ë¶„ì„í•´ì„œ QClass ë¥¼ ë§Œë“ ë‹¤.
 QClass ëŠ” Entity ì™€ í˜•íƒœê°€ ë˜‘ê°™ì€ Static Class ì´ë‹¤.
 QueryDSL ì€ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ë•Œ QClass ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œë‹¤.

JPQL ì´ë€ ?
 JPA ì—ì„œ ì§€ì›í•˜ëŠ” ë‹¤ì–‘í•œ ì¿¼ë¦¬ ë°©ë²• ì¤‘ ê°€ì¥ ë‹¨ìˆœí•œ ì¡°íšŒ ë°©ë²•ìœ¼ë¡œ, 
 SQL ì˜ ê²½ìš°ì—ëŠ” DB í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì§ˆì˜í•˜ì§€ë§Œ, 
 JPQL ì€ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì§ˆì˜í•œë‹¤.

 EX)

  String jpql = â€œselect m From MemberEntity m where m.userName like â€˜%hello%â€™â€;
  List<Member> result = em.createQuery(jpql, Member.class).getResultList();
  (SQL ë¡œ ë³€í™˜ì‹œ) select * from members where user_name like â€˜%hello%â€™;


JPQL ì—ëŠ” ë¬¸ì œì ì´ ì¡´ì¬í•œë‹¤.

JPQL ì˜ ë¬¸ì œì  --------------------------------------
 â‘  ì¿¼ë¦¬ë¥¼ ì—¬ì „íˆ ë¬¸ìì—´ë¡œ ì…ë ¥í•œë‹¤.
    -> ì˜¤íƒ€ê°€ ë°œìƒí•˜ê±°ë‚˜ ê´€ë¦¬í•˜ëŠ”ë° ìˆì–´ì„œ ì–´ë ¤ì›€ì´ ë”°ë¥´ê³ , type-check ê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤

 â‘¡ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ê³ , ëŸ°íƒ€ì„ì—ì„œ í•´ë‹¹ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì–´ì•¼ ì˜¤ë¥˜ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆë‹¤.
    -> í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì§œë©´ ë¶ˆì•ˆì„ ëœ ìˆ˜ ìˆê¸´ í•˜ì§€ë§Œ, 
      ì‹¤ì œ í”„ë¡œê·¸ë¨ì„ ìš´ì˜í•˜ë©´ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ë„ ìˆë‹¤ëŠ” ë¶€ë‹´ì´ ë„ˆë¬´ ì»¤ì§„ë‹¤.

 QueryDSL JPA ëŠ” JPQL ì´ ê°€ì§€ê³  ìˆëŠ” ë¬¸ì œì ë“¤ì„ í•´ê²°í•´ì¤€ë‹¤.

QueryDSL JPA ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì´ìœ  ---------------------------
 â‘  ì¿¼ë¦¬ë¥¼ ì—¬ì „íˆ ë¬¸ìì—´ë¡œ ì…ë ¥í•˜ê¸° ë•Œë¬¸ì— ì˜¤íƒ€ê°€ ë°œìƒí•˜ê±°ë‚˜ ê´€ë¦¬í•˜ê¸° ì–´ë µë‹¤.
    -> QueryDSL ì€ ì¿¼ë¦¬ë¥¼ ë¬¸ìì—´ë¡œì„œê°€ ì•„ë‹ˆë¼ ì½”ë“œë¥¼ í†µí•´ì„œ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— ì˜¤íƒ€ê°€ ë‚  í™•ë¥ ì´ ì ì–´ì§€ê³ , 
      ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ê°œë°œí•  ìˆ˜ ìˆë‹¤.

 â‘¡ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ê³ , ëŸ°íƒ€ì„ ì‹œ í•´ë‹¹ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì–´ì•¼ì§€ë§Œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
    -> QueryDSL ì€ ì½”ë“œë¡œì„œ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œë„ ì˜¤ë¥˜ë¥¼ ë¹ ë¥´ê²Œ ë°œê²¬í•  ìˆ˜ ìˆë‹¤.

    ì˜ˆë¥¼ ë“¤ì–´ì„œ
    íšŒì›(member) ì™€ í¬ì¸íŠ¸(point) ë¥¼ ì¡°ì¸í•´ì„œ ê°€ì ¸ì™€ì•¼ í•  ë•Œ
    JPQL ì˜ ê²½ìš°ì—ëŠ”

    String jpql = "select * from Member m join Point p on p.member_id = m.id"
    List<Member> result = em.createQuery(jpql, Member.class).getResultList();
    ì´ëŸ°ì‹ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•´ì•¼ í•˜ì§€ë§Œ,
    QueryDSL ì„ ì‚¬ìš©í–ˆì„ ë•Œì—ëŠ”

    return jpaQueryFactory
          .from(member)
          .join(member.point, point)
          .fetch();

    ì´ëŸ° ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‚¬ìš©í•´ì„œ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆë‹¤.
    ì˜¤íƒ€ê°€ ë‚˜ë”ë¼ë„ ì»´íŒŒì¼ ë‹¨ê³„ì—ì„œ ì˜¤ë¥˜ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆê³ , 
    ì½”ë“œë¡œì„œ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— ë”ìš± ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ê°œë°œí•  ìˆ˜ ìˆë‹¤.

ì´ëŸ¬í•œ ì´ìœ ë¡œ spring ì—ì„œ JPA ë¥¼ ì‚¬ìš©í•  ë•Œ QueryDSL JPA ë¥¼ ë³´í†µ í•¨ê»˜ ì‚¬ìš©í•œë‹¤.
// ***********************************************************


[1]. build.gradle ì— QueryDSL ì„¸íŒ…í•˜ê¸° ******************************

ë¨¼ì € build.gradle ì— QueryDSL ê´€ë ¨ ì½”ë“œë¥¼ ì„¸íŒ…í•´ì¤˜ì•¼ í•œë‹¤.

// build.gradle ------------------------------------------------------------------------
dependencies {
	... 
	// ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ì´ìƒ : Unable to load class 'javax.persistence.Entity'. ì—ëŸ¬ ë°œìƒí•  ê²½ìš°
	//implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
	//annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jakarta"

	// ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ë¯¸ë§Œ
	implementation 'com.querydsl:querydsl-jpa'
	annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jpa"

	implementation 'com.querydsl:querydsl-core'
	implementation "com.querydsl:querydsl-collections"

	annotationProcessor "jakarta.annotation:jakarta.annotation-api" // java.lang.NoClassDefFoundError (javax.annotation.Generated) ì—ëŸ¬ ëŒ€ì‘ ì½”ë“œ
	annotationProcessor "jakarta.persistence:jakarta.persistence-api" // java.lang.NoClassDefFoundError (javax.annotation.Entity) ì—ëŸ¬ ëŒ€ì‘ ì½”ë“œ
}

def querydslSrcDir = 'src/main/generated'
sourceSets {
  main {
    java {
      srcDirs += [ querydslSrcDir ]
    }
  }
}

compileJava {
    options.compilerArgs << '-Aquerydsl.generatedAnnotationClass=javax.annotation.Generated'
}

tasks.withType(JavaCompile) {
	options.generatedSourceOutputDirectory = file(querydslSrcDir)
}

clean {
  delete file(querydslSrcDir)
}
//-------------------------------------------------------------------------------------------------

[dependencies ì„¤ëª…]

 * implementation 'com.querydsl:querydsl-jpa'
   â†’ QueryDSL ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
   â†’ QuerydslRepositorySupport, QuerydslPredicateExecutor ë“± 
      QueryDSL ë‚´ë¶€ í´ë˜ìŠ¤ëŠ” ì‚¬ìš© ê°€ëŠ¥í•˜ì§€ë§Œ, ì‹¤ì œë¡œ ì¿¼ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” QClass ëŠ” ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤.

 * implementation 'com.querydsl:querydsl-apt'
   â†’ QClass ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

 * annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jpa"
   â†’ QueryDSL JPA ì˜ ê²½ìš°ì—ëŠ” QClass ë¥¼ í™œìš©í•´ì„œ ë™ì‘í•˜ëŠ”ë° 
      @Entity ì–´ë…¸í…Œì´ì…˜ì„ ì„ ì–¸í•œ í´ë˜ìŠ¤ë¥¼ íƒìƒ‰í•˜ê³ , QClass ë¥¼ ìƒì„±í•œë‹¤.

 * QClass ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•ì—ëŠ” í¬ê²Œ ë‘ê°€ì§€ë¡œ ë‚˜ë‰œë‹¤.

   â‘  com.ewerk.gradle.plugins.querydsl ì‚¬ìš©
    -> 2018ë…„ ì´í›„ ì—…ë°ì´íŠ¸ ëœ ì ì´ ì—†ë‹¤.
    -> gradle ë²„ì „ì´ ê³„ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ë©´ì„œ í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ ì™¸ ì—¬ëŸ¬ê°€ì§€ ì„¤ì •í•´ì¤˜ì•¼ í•  ê²ƒë“¤ì´ ë§ë‹¤.

   â‘¡ annotationProcessor ì‚¬ìš©    

     annotationProcessor 'jakarta.persistence:jakarta.persistence-api'
     annotationProcessor 'jakarta.annotation:jakarta.annotation-api'

    -> ì´í´ë¦½ìŠ¤ ì¬ë‹¨ìœ¼ë¡œ ìë°”ê°€ ì´ê´€ë˜ë©´ì„œ java â†’ jakarta ë¡œ ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆë‹¤.
    -> Q íŒŒì¼ì„ ì°¾ì§€ ëª»í•´ì„œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ì¸ java.lang.NoClassDefFoundError 
      (javax.annotation.Entity / javax.annotation.Generated) ì—ëŸ¬ ë°œìƒ ëŒ€ì‘ì„ ìœ„í•œ ì½”ë“œì´ë‹¤.

//sourceSets ---------------------------------------------------------------------
def querydslSrcDir = 'src/main/generated'
sourceSets {
  main {
    java {
      srcDirs += [ querydslSrcDir ]
    }
  }
}
//-----------------------------------------------------------------------------------
 -> gradle build ì‹œ QClass ì†ŒìŠ¤ë„ í•¨ê»˜ build í•˜ê¸° ìœ„í•´ì„œ sourceSets ì— í•´ë‹¹ ìœ„ì¹˜ë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.


//compileJava -----------------------------------------------------------------------
compileJava {
    options.compilerArgs << '-Aquerydsl.generatedAnnotationClass=javax.annotation.Generated'
}
//-----------------------------------------------------------------------------------
 -> í•´ë‹¹ ë‚´ìš©ì„ ëª…ì‹œí•´ì£¼ì§€ ì•Šìœ¼ë©´ Q íŒŒì¼ ë‚´ Generated ë¥¼ import í•  ë•Œ 
   ìë°” 9 ì—ë§Œ ìˆëŠ” import javax.annotation.processing.Generated ë¡œ import í•´ì¤€ë‹¤.
 -> ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ë²„ì „ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ java.annotation.Generated ë¡œ import í•˜ë„ë¡ 
   ì„¤ì •í•˜ëŠ” ì½”ë“œì´ë‹¤.


//tasks.withType -------------------------------------------------------------------
tasks.withType(JavaCompile) {
	options.generatedSourceOutputDirectory = file(querydslSrcDir)
}
//------------------------------------------------------------------------------------
 -> annotationProcessorGeneratedSourcesDirectory ë¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆëŠ”ë°,
   Gradle ê³µì‹ ë¬¸ì„œì— í•´ë‹¹ ê¸°ëŠ¥ì€ deprecated ë˜ì—ˆê³ , 
   ì¶”í›„ major version ì—ì„  ì‚­ì œí•  ê²ƒì´ë¼ê³  ì†Œê°œí•˜ê³  ìˆê¸° ë•Œë¬¸ì— 
   generatedSourceOutputDirectory ë¥¼ ì‚¬ìš©í•œë‹¤.
 -> generatedSourceOutputDirectory ëŠ” 
   annotation processors ì—ì„œ ìƒì„±í•œ ì†ŒìŠ¤ íŒŒì¼ì„ ì €ì¥í•  ë””ë ‰í† ë¦¬ë¥¼ ì§€ì •í•´ ì¤€ë‹¤. 
   (Gradle ê³µì‹ë¬¸ì„œ â†’ CompileOptions - Gradle DSL Version 7.5.1 )
 -> ì´ ì½”ë“œë¥¼ í†µí•´ ìœ„ì—ì„œ ì„ ì–¸í•œ querydslSrcDir ë³€ìˆ˜ì˜ src/main/generated ì— 
   annotation processors ê°€ ë§Œë“  QClass ë“¤ì„ ì €ì¥í•´ ì¤€ë‹¤.


//clean -----------------------------------------------------------------------------
clean {
	// clean ì‹¤í–‰ ì‹œ ìƒì„±ëœ QClass ì‚­ì œ
	delete file(querydslSrcDir)
}
//-------------------------------------------------------------------------------------
 -> build clean ì‹œì— ìƒì„±ë˜ì—ˆë˜ QClass ë¥¼ ëª¨ë‘ ì‚­ì œ (querydslSrcDir = src/main/generated)


[ì‹¤í–‰í•˜ê¸°] ----------------------------------------------------------------------------
ë§Œë“¤ì–´ì§„ QClass ì‚­ì œí•˜ê¸° : Gradle > build > clean
QClass ë§Œë“¤ê¸° : Gradle > build > compileJava
***
src > main > generated ë‚´ì— Q í´ë˜ìŠ¤ê°€ ë§Œë“¤ì–´ì¡Œìœ¼ë©´ queryDSL ì„¤ì •ì´ ì •ìƒì ìœ¼ë¡œ ëœ ê²ƒì´ë‹¤.
***


[2]. QueryDSL ì‚¬ìš©í•˜ê¸° ************************************************

â‘  QuerydslConfig íŒŒì¼ ì„¤ì •í•˜ê¸° ------------------------------------------
//-----------------------------------------------------------------------
@Configuration
public class QuerydslConfig {
    @PersistenceContext
    private EntityManager entityManager;

    @Bean
    public JPAQueryFactory jpaQueryFactory() {
	return new JPAQueryFactory(entityManager);
    }
}
//-----------------------------------------------------------------------

[ì½”ë“œ ì„¤ëª…] 

 * @PersistenceContext
   EntityManager ë¥¼ ë¹ˆìœ¼ë¡œ ì£¼ì…í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜
   ë¹ˆìœ¼ë¡œ ì£¼ì…ë°›ì„ ë•Œ EntityManager ì˜ ê²½ìš° @Autowired ê°€ ì•„ë‹ˆë¼ í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì£¼ì…
   JPAQueryFactory ë¥¼ Bean ìœ¼ë¡œ ë“±ë¡í•´ì„œ í”„ë¡œì íŠ¸ ì „ì—­ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤

â‘¡ QueryDSL ì‚¬ìš© Repository êµ¬ì¡° ì¡ê¸°
Spring ì—ì„œ QueryDSL ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì—ëŠ”
ì´ 3ê°€ì§€ ë°©ë²• (Spring Data Jpa Custom Repository / QueryRepositorySupport / JPAQueryFactory) ì´ ìˆë‹¤.

1. Spring Data JPA Custom Repository ì‚¬ìš©

Spring ì—ì„œ QueryDSL ê³¼ JPARepository ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ë ¤ë©´ ê° ì—­í•  ë³„ íŒŒì¼ì„ ë‘ ê°œ ë§Œë“¤ì–´ì£¼ê±°ë‚˜, í•˜ë‚˜ì˜ íŒŒì¼ì´ ë‘ ê°œì˜ ì˜ì¡´ì„±ì„ ê°€ì ¸ì•¼ í•œë‹¤. ì´ëŸ¬í•œ ê²½ìš° Spring Data JPA ì—ì„œ ì œê³µí•˜ëŠ” âœ¨Spring Data Custom Repositoryâœ¨ ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ê³µì‹ Docs â†’ Spring Data JPA - Reference Documentation

í•´ë‹¹ ë°©ì‹ì„ í†µí•´ì„œ CustomRepository ë¥¼ JpaRepository ìƒì† í´ë˜ìŠ¤ì—ì„œ í•¨ê»˜ ìƒì† ë°›ì•„ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

êµ¬í˜„ëœ Repository êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.


Repository(interface) ê°€ JpaRepository(interface), CustomRepository(interface)ë¥¼ ë‹¤ì¤‘ ìƒì† ë°›ê³ ,
â†’ CustomRepository ì¸í„°í˜ì´ìŠ¤ì— ì„ ì–¸ë˜ì–´ ìˆëŠ” ë©”ì†Œë“œì— ëŒ€í•œ êµ¬í˜„ì€ RepositoryImpl ì—ì„œ í•œë‹¤.
â†’ ê·¸ë¦¬ê³  ì‚¬ìš©ìëŠ” Repository ì¸í„°í˜ì´ìŠ¤ë¥¼ DI ë°›ì•„ì„œ ì‚¬ìš©í•œë‹¤.

ğŸ¤” ê·¼ë°, RepositoryImplì€ Repositoryë¥¼ ì§ì ‘ì ìœ¼ë¡œ êµ¬í˜„í•˜ì§€ ì•ŠëŠ”ë° ì–´ë–»ê²Œ Repositoryì—ì„œ ì‚¬ìš©ê°€ëŠ¥í• ê¹Œ ?
:ğŸ’¡ ì‚¬ìš©ì ì •ì˜ êµ¬í˜„ í´ë˜ìŠ¤ì¸ ê²½ìš° JPA ê°€ íŒŒì¼ëª…ì´ repository interface ì´ë¦„ + Impl ì¸ í´ë˜ìŠ¤ë¥¼ ì°¾ì•„ì„œ interface ì— JpaRepositoryë¥¼ Injection í•  ë•Œì— Impl ê°ì²´ë¥¼ ì‚½ì…í•´ì£¼ê¸° ë•Œë¬¸ì— ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
â†’ ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë°˜ë“œì‹œ êµ¬í˜„ì²´ íŒŒì¼ëª…ì´ interface ëª… + impl ì´ì—¬ì•¼ í•œë‹¤.

ì´ ë°©ì‹ì˜ ê²½ìš° ì´ 3ê°œì˜ repository ê´€ë ¨ íŒŒì¼ì´ ë§Œë“¤ì–´ì§„ë‹¤.

ì²«ë²ˆì§¸, Repository íŒŒì¼ (interface)
JpaRepository ì™€ Custom interface ë¥¼ ìƒì†í•œ íŒŒì¼
ì‚¬ìš©ìëŠ” í•´ë‹¹ íŒŒì¼ì„ DI ë°›ì•„ì„œ ì‚¬ìš©í•œë‹¤

public interface ContentRepository extends JpaRepository<Content, Long>, ContentRepositoryCustom {
}
ë‘ë²ˆì§¸, RepositoryCustom íŒŒì¼ (interface)
QueryDSL ë¡œ ì»¤ìŠ¤í…€í•´ì„œ ì‚¬ìš©í•  ë©”ì†Œë“œ ì„ ì–¸í•˜ëŠ” íŒŒì¼

public interface ContentRepositoryCustom {
}
ì„¸ë²ˆì§¸, RepositoryImpl íŒŒì¼ (class)
RepositoryCustom interface ì— ì„ ì–¸í•œ ë©”ì†Œë“œ êµ¬í˜„í•˜ëŠ” íŒŒì¼

@RequiredArgsConstructor
public class ContentRepositoryImpl implements ContentRepositoryCustom {
  private final JPAQueryFactory queryFactory;
}
EX)

public interface ContentRepositoryCustom {
}

@RequiredArgsConstructor
public class ContentRepositoryImpl implements ContentRepositoryCustom {
  private final JPAQueryFactory queryFactory;
}

public class ContentRepository extends JpaRepository<Content, Long>, ContentRepositoryCustom {

}
ë‹¨ì 
QueryDSL ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë§Œë“¤ì–´ì•¼ í•˜ëŠ” íŒŒì¼ì´ ì—„ì²­ ë§ì•„ì§€ê³ , ê·¸ì— ë”°ë¥¸ ê´€ë¦¬ í¬ì¸íŠ¸ê°€ ëŠ˜ì–´ë‚œë‹¤.

2. QueryRepositorySupport ìƒì†í•˜ê¸°

ì²«ë²ˆì§¸ ë°©ì‹ì²˜ëŸ¼ ì—¬ëŸ¬ íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ìƒì†ë°›ëŠ” ë°©ì‹ì´ ì•„ë‹ˆë¼ QuerydslRepositorySupport ë§Œ ìƒì†í•˜ì—¬ êµ¬ì¡°ë¥¼ ë‹¨ìˆœí™” í•˜ëŠ” ë°©ì‹

@Repository 
public class ContentRepositorySupport extends QuerydslRepositorySupport {
  private final JPAQueryFactory queryFactory;
  
  public ContentRepositorySupport(JPAQueryFactory queryFactory) {
    super(Content.class);
    this.queryFactory = queryFactory;
  }
}
ë‹¨ì 
â†’ ë§¤ë²ˆ Support ë¥¼ ìƒì† ë°›ê³ , super ìƒì„±ìì— Entity ë¥¼ ë“±ë¡í•´ì¤˜ì•¼ í•œë‹¤.
â†’ Entity ë¥¼ save, delete í•˜ëŠ” repository ì™€ query í•˜ëŠ” repository ê°€ ë‚˜ë‰˜ì–´ ì§„ë‹¤.

3. JPAQueryFactory ì‚¬ìš©í•˜ê¸°

JPAQueryFactory ë§Œ ìˆìœ¼ë©´ QueryDSL ê¸°ëŠ¥ì„ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

2ë²ˆì§¸ ë°©ì‹ ì²˜ëŸ¼ super & ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” Q í´ë˜ìŠ¤ë¥¼ import í•´ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹

@RequiredArgsConstructor
@Repository
public class ContentQueryRepository {
  private final JPAQueryFactory queryFactory;
  
  public List<Content> findByTitle(String title) {
    return queryFactory
              .selectFrom(content)
              .where(content.title.eq(title))
              .fetch();
  }
}
ë‹¨ì 

Entity ë¥¼ save, delete í•˜ëŠ” repository ì™€ query í•˜ëŠ” Repository ê°€ ë‚˜ë‰˜ì–´ ì§„ë‹¤.

ë‚´ê°€ ì‚¬ìš©í•˜ëŠ” QueryDSL ì‚¬ìš© ë°©ì‹
ë‚´ê°€ QueryDSL ì„ ì‚¬ìš©í•  ë•Œì—ëŠ” ì²«ë²ˆì§¸ ë°©ì‹ìœ¼ë¡œ ê°€ì¥ ë§ì´ ì‚¬ìš©í•œë‹¤.

ë‘ë²ˆì§¸ (QueryRepositorySuppor), ì„¸ë²ˆì§¸ (JPAQueryFactory) ë°©ì‹ì˜ ê²½ìš°ì—ëŠ” Spring JPA ê¸°ëŠ¥ê³¼ QueryDSL ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ ê°ê° íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë‘˜ ê°„ì˜ ì—°ê´€ê´€ê³„ë„ ì—†ê³ , íŒŒì¼ë§Œ ë´¤ì„ ë•Œ ì• ë§¤í•  ìˆ˜ ìˆë‹¤.

ë‘ë²ˆì§¸, ì„¸ë²ˆì§¸ ë°©ì‹ì˜ ê²½ìš° ì‚¬ìš© ì˜ˆì‹œ ğŸ‘‡

public interface ContentJpaRepository extends JpaRepository<Content, Long> {
}

@RequiredArgsConstructor
public class ContentQueryRepository {
  private final JPAQueryFactory jpaQueryFactory;
}

@RequiredArgsConstructor
public class Test {
  private final ContentJpaRepository contentJpaRepository;
  private final ContentQueryRepository contentQueryRepository;
  
  public void test() {
    contentJpaRepository.save();
    contentQueryRepository.customMethod();
  }
}
ì²«ë²ˆì§¸ ë°©ì‹ìœ¼ë¡œ í•œë‹¤ê³  í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

ContentRepositoryCustom.java

public interface ContentRepositoryCustom {
    Content findByUserSeq(Long userSeq);
}
ContentRepositoryImpl.java

import static show.grip.admin.content.model.QContent.content;

@Repository
@RequiredArgsConstructor
public class ContentRepositoryImpl implements ContentRepositoryCustom {
    private final JPAQueryFactory queryFactory;

    @Override
    public Content findByUserSeq(Long userSeq) {
        return queryFactory
                .selectFrom(content)
                .where(content.userSeq.eq(userSeq))
                .fetchFirst();
    }
}
ContentRepository.java

public interface ContentRepository extends JpaRepository<Content, Long>, ContentRepositoryCustom {
}
ì½”ë“œì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•˜ê¸°

contentRepository.findByUserSeq(userSeq);
ë¬¼ë¡  ë‚´ê°€ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì´ ë¬´ì¡°ê±´ì ìœ¼ë¡œ ì˜³ë‹¤ëŠ” ê±´ ì•„ë‹ˆë¼ ê°ê°ì˜ ë°©ì‹ì—ëŠ” ì¥ë‹¨ì ì´ ì¡´ì¬í•œë‹¤.
ê° ë°©ì‹ì— ëŒ€í•´ì„œ ì¥ë‹¨ì  ë° ì‚¬ìš©ë°©ì‹ì„ íŒŒì•…í•˜ê³ , í”„ë¡œì íŠ¸ì— ë§ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ì ~